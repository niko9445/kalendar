/* Импортируем Tailwind CSS */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Подключаем шрифт Inter */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

/* Базовые стили */
@layer base {
  :root {
    color-scheme: light;
  }
  
  .dark {
    color-scheme: dark;
  }
  
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  body {
    @apply bg-background dark:bg-dark-background text-text-primary dark:text-dark-text-primary font-sans;
    font-feature-settings: "ss01", "ss02", "cv01", "cv02";
    -webkit-text-size-adjust: 100%;
    transition: background-color 0.2s ease, color 0.2s ease;
  }
  
  /* Убираем стандартные стили кнопок - ВСЕ ФОКУСЫ СИНИЕ */
  button {
    @apply focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900;
  }
  
  /* Кастомный скроллбар */
  ::-webkit-scrollbar {
    width: 6px;
  }
  
  ::-webkit-scrollbar-track {
    @apply bg-gray-100 dark:bg-gray-800;
  }
  
  ::-webkit-scrollbar-thumb {
    @apply bg-gray-400 dark:bg-gray-600 rounded-full;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-500 dark:bg-gray-500;
  }
  
  /* КРИТИЧЕСКИ ВАЖНЫЕ СТИЛИ ДЛЯ iOS */
  
  /* 1. Убираем зумирование при фокусе на input */
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="tel"],
  input[type="number"],
  textarea {
    font-size: 16px !important;
  }
  
  /* 2. Особые стили для input[type="date"] на iOS */
  input[type="date"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    
    min-height: 40px !important;
    height: 40px !important;
    line-height: 1.25 !important;
    padding-top: 8px !important;
    padding-bottom: 8px !important;
    font-size: 14px !important;
    
    @apply dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600;
    
    &::-webkit-date-and-time-value {
      text-align: left;
      margin: 0;
      height: auto;
      font-size: 14px !important;
    }
    
    &::-webkit-calendar-picker-indicator {
      opacity: 0;
      position: absolute;
      right: 0;
      top: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    &::-webkit-inner-spin-button,
    &::-webkit-clear-button {
      display: none;
      -webkit-appearance: none;
      margin: 0;
    }
    
    &::-webkit-datetime-edit {
      padding: 0;
      margin: 0;
      line-height: 1.25;
      font-size: 14px !important;
    }
    
    &::-webkit-datetime-edit-fields-wrapper {
      padding: 0;
      margin: 0;
    }
  }
  
  /* 3. Для селектов - свой размер шрифта */
  select {
    font-size: 14px !important;
    min-height: 40px !important;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236B7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
    padding-right: 40px !important;
    
    @apply dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600;
  }
  
  /* 4. Для всех текстовых полей ввода - одинаковые размеры, но разный font-size */
  input:not([type="date"]):not([type="checkbox"]):not([type="radio"]),
  textarea {
    min-height: 40px !important;
    font-size: 14px !important;
    @apply dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600;
  }
  
  /* 5. Предотвращение скролла фона при открытой модалке */
  body.modal-open {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
    height: 100% !important;
  }
}

/* Кастомные классы компонентов */
@layer components {
  /* Кнопки */
  .btn {
    @apply px-4 py-2.5 text-sm font-medium rounded-md transition-all duration-150
           focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900
           disabled:opacity-50 disabled:cursor-not-allowed;
  }
  
  .btn-primary {
    @apply bg-blue-600 dark:bg-blue-600 text-white hover:bg-blue-700 dark:hover:bg-blue-700
           active:bg-blue-800 dark:active:bg-blue-800 active:scale-[0.98];
  }
  
  .btn-secondary {
    @apply bg-blue-500 dark:bg-blue-500 text-white hover:bg-blue-600 dark:hover:bg-blue-600
           active:bg-blue-700 dark:active:bg-blue-700 active:scale-[0.98];
  }
  
  .btn-outline {
    @apply bg-transparent border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300
           hover:bg-gray-50 dark:hover:bg-gray-800 hover:border-gray-400 dark:hover:border-gray-500
           active:bg-gray-100 dark:active:bg-gray-700 active:scale-[0.98];
  }
  
  .btn-ghost {
    @apply bg-transparent text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800
           active:bg-gray-200 dark:active:bg-gray-700 active:scale-[0.98];
  }
  
  /* Поля ввода - с правильным размером шрифта */
  .input {
    @apply w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-md
           focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500
           dark:focus:ring-blue-500 dark:focus:border-blue-500
           placeholder:text-gray-400 dark:placeholder:text-gray-500 transition-all duration-150
           disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:text-gray-500 dark:disabled:text-gray-400 disabled:cursor-not-allowed
           min-h-[40px] text-sm dark:bg-gray-800 dark:text-gray-100;
  }
  
  /* Карточки */
  .card {
    @apply bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm;
  }
  
  /* Навигация */
  .nav-item {
    @apply flex items-center justify-center transition-all duration-150
           hover:bg-gray-100 dark:hover:bg-gray-800 active:scale-95;
  }
  
  /* Модальные окна */
  .modal-overlay {
    @apply fixed inset-0 bg-black/30 dark:bg-black/50 backdrop-blur-sm;
  }
  
  .modal-content {
    @apply bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg;
  }
}

/* Safe Area поддержка для iPhone */
.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
}

.pb-safe {
  padding-bottom: env(safe-area-inset-bottom, 0);
}

.pt-safe {
  padding-top: env(safe-area-inset-top, 0);
}

/* Убираем стандартное поведение кнопок на мобильных */
button, 
[role="button"] {
  -webkit-tap-highlight-color: transparent;
  outline: none;
}

/* Для iOS Safari */
@supports (-webkit-touch-callout: none) {
  button, 
  [role="button"] {
    -webkit-tap-highlight-color: transparent;
    cursor: pointer;
  }
  
  /* Хак для Safari чтобы поля не вылезали за границы */
  input, select, textarea {
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    border-radius: 6px;
  }
  
  /* Особый фикс для input[type="date"] на iOS 15+ */
  input[type="date"] {
    position: relative;
    z-index: 1;
    @apply bg-white dark:bg-gray-800 !important;
    @apply border border-gray-300 dark:border-gray-600 !important;
  }
  
  /* На iOS для текстовых полей увеличиваем font-size только при фокусе */
  input[type="text"]:focus,
  input[type="email"]:focus,
  input[type="password"]:focus,
  input[type="tel"]:focus,
  input[type="number"]:focus,
  textarea:focus {
    font-size: 16px !important;
  }
  
  /* Для неактивных полей оставляем 14px */
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="tel"],
  input[type="number"],
  textarea {
    font-size: 14px !important;
  }
}

/* Убираем голубое выделение при тапе на iOS */
* {
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  -webkit-tap-highlight-color: transparent;
}

/* Анимации для модалок */
.modal-slide-up {
  animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
  from {
    transform: translateY(100%);
  }
  to {
    transform: translateY(0);
  }
}

/* Медиа-запросы для мобильных устройств */
@media screen and (max-width: 767px) {
  /* На мобильных увеличиваем font-size только для нужных полей */
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="tel"],
  input[type="number"],
  textarea {
    font-size: 16px !important;
  }
  
  /* Селекты и даты оставляем 14px */
  select,
  input[type="date"] {
    font-size: 14px !important;
  }
  
  /* Особенно для даты */
  input[type="date"] {
    padding-top: 10px !important;
    padding-bottom: 10px !important;
  }
  
  /* Улучшение касания на мобильных */
  .touch-target {
    min-height: 44px !important;
    min-width: 44px !important;
  }
}

/* Фикс для Firefox */
@-moz-document url-prefix() {
  input[type="date"] {
    padding-top: 10px !important;
    padding-bottom: 10px !important;
  }
}

/* Для очень маленьких экранов (iPhone SE и т.д.) */
@media screen and (max-width: 320px) {
  .modal-content {
    margin: 0 8px !important;
    max-width: calc(100% - 16px) !important;
  }
}

/* Компактные карточки */
.compact-card {
  transition: all 0.2s ease;
}

.compact-card:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Уменьшаем все отступы в компактном режиме */
.compact-mode .card {
  padding: 0.75rem !important;
}

.compact-mode .text-sm {
  font-size: 0.8125rem !important;
}

.compact-mode .text-xs {
  font-size: 0.6875rem !important;
}

/* Плавный переход для темной темы */
* {
  transition: background-color 0.2s ease, border-color 0.2s ease;
}